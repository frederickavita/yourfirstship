<aside class="w-64 bg-slate-900 text-slate-300 hidden md:flex flex-col border-r border-slate-800">
    
    <div class="h-16 flex items-center px-6 border-b border-slate-800">
        <i data-lucide="ship" class="text-indigo-500 h-6 w-6 mr-3"></i>
        <span class="font-bold text-white text-lg tracking-tight">YourFirstShip</span>
    </div>

    <nav class="flex-1 px-4 py-6 space-y-2">
        {{
        def get_nav_class(target_function):
            # Vérifie si l'URL actuelle correspond au bouton
            is_active = (request.function == target_function)
            base = "flex items-center gap-3 px-4 py-3 rounded-lg border transition-colors duration-200"
            
            if is_active:
                # Style ACTIF (Indigo, fond clair)
                return f"{base} bg-indigo-600/10 text-indigo-400 border-indigo-600/20"
            else:
                # Style INACTIF (Gris, hover blanc)
                return f"{base} border-transparent text-slate-400 hover:bg-slate-800 hover:text-white"
            pass
        }}

        <a href="{{=URL('dashboard')}}" class="{{=get_nav_class('dashboard')}}">
            <i data-lucide="layout-grid" class="h-5 w-5"></i><span class="font-medium">Dashboard</span>
        </a>
        
        <a href="{{=URL('treasury')}}" class="{{=get_nav_class('treasury')}}">
            <i data-lucide="wallet" class="h-5 w-5"></i><span class="font-medium">Trésorerie</span>
        </a>
        
        <a href="{{=URL('support')}}" class="{{=get_nav_class('support')}}">
            <i data-lucide="life-buoy" class="h-5 w-5"></i><span class="font-medium">Support</span>

            {{if 'unread_support_count' in globals() and unread_support_count > 0:}}
            <span class="bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full shadow-sm animate-pulse">
                {{=unread_support_count}}
            </span>
            {{pass}}
        </a>
    </nav>

   <div class="p-4 border-t border-slate-800">
        {{
        # 1. On détermine le nom à afficher
        if auth.user and auth.user.first_name and str(auth.user.first_name) != 'None':
            display_name = auth.user.first_name
            initial = auth.user.first_name[0].upper()
        elif auth.user and auth.user.email:
            # On prend ce qui est avant le @ (ex: frederickavita)
            display_name = auth.user.email.split('@')[0]
            initial = display_name[0].upper()
        else:
            # Fallback ultime
            display_name = "Captain"
            initial = "C"
        pass
        }}

        <div class="flex items-center gap-3 mb-4 px-2">
            <div class="h-8 w-8 rounded-full bg-indigo-500 flex items-center justify-center text-white font-bold text-xs shadow-md border border-indigo-400">
                {{=initial}}
            </div>
            
            <div class="overflow-hidden">
                <p class="text-sm font-medium text-white truncate w-32" title="{{=display_name}}">
                    {{=display_name}}
                </p>
                <a href="{{=URL('profile')}}" class="text-xs text-slate-500 hover:text-indigo-400 transition-colors">
                    Voir Profil
                </a>
            </div>
        </div>
        
        <a id="logout" href="{{=URL('user', args='logout')}}" class="flex items-center gap-2 text-xs text-slate-500 hover:text-red-400 px-2 transition-colors duration-200">
            <i data-lucide="log-out" class="h-3 w-3"></i> Déconnexion
        </a>
    </div>
</aside>